{
    "contents" : "#Tstats Darwin finch\n\nsource(\"C:/Users/taudiere/Dropbox/3-THESE/Article T stats/Package Tstats//function_CVNND.R\")\nsource(\"C:/Users/taudiere/Dropbox/3-THESE/Article T stats/Package Tstats//function_Tstats.r\")\nsource(\"C:/Users/taudiere/Dropbox/3-THESE/Article T stats/Package Tstats//function_Tstats_hv.r\")\nsource(\"C:/Users/taudiere/Dropbox/3-THESE/Article T stats/Package Tstats//function_variance.R\")\nsource(\"C:/Users/taudiere/Dropbox/3-THESE/Article T stats/Aiba et al 2013 avec na.rm=T.r\")\nsource(\"C:/Users/taudiere/Dropbox/3-THESE/Article T stats/Aiba et al 2013 modif.r\")\n\n\nsource('~/Dropbox/3-THESE/Article T stats/Package Tstats/function_CVNND.R')\nsource('~/Dropbox/3-THESE/Article T stats/Package Tstats/function_Tstats.r')\nsource('~/Dropbox/3-THESE/Article T stats/Package Tstats/function_variance.R')\n\n\n\nfinch <- read.csv(\"C:/Users/taudiere/Dropbox/Analyses en cours/Tstats sur pinson/Morph_for_Sato.csv\", sep=\";\")\n#attention il faut changer les virgule en \".\" dans le fichier texte enqui car sinon on obtient des facteurs pour certains traits avec des NA qui s'ajoutent lorsqu'on passe en as.numeric\n\ntraits.finch<-finch[,11:14]\nTsp.finch<-paste(finch[,4],finch[,5], sep=\"_\")\n  \n\nrequire(RColorBrewer)\ncolor.IslandID<-brewer.pal(7,\"Set1\")\npar(mfrow=c(2,2))\n\nfor(t in 1:4){\n  plot(density(traits.finch[finch$IslandID==levels(finch$IslandID)[2],t], na.rm=T), ylim=c(0,0.66), xlim=c(min(traits.finch[,t], na.rm=T),max(traits.finch[,t], na.rm=T)), col=color.IslandID[2])\n  if(sum(traits.finch[finch$IslandID==levels(finch$IslandID)[1],t], na.rm=T)>0) {lines(density(traits.finch[finch$IslandID==levels(finch$IslandID)[1],t], na.rm=T), col=color.IslandID[1])}\n  lines(density(traits.finch[finch$IslandID==levels(finch$IslandID)[3],t], na.rm=T), col=color.IslandID[3])\n  lines(density(traits.finch[finch$IslandID==levels(finch$IslandID)[4],t], na.rm=T), col=color.IslandID[4])\n  lines(density(traits.finch[finch$IslandID==levels(finch$IslandID)[5],t], na.rm=T), col=color.IslandID[5])\n  lines(density(traits.finch[finch$IslandID==levels(finch$IslandID)[6],t], na.rm=T), col=color.IslandID[6])\n  lines(density(traits.finch[finch$IslandID==levels(finch$IslandID)[7],t], na.rm=T), col=color.IslandID[7])\n}\n\npar(mfrow=c(1,1))\n\n\npar(mfrow=c(2,2))\nfor(t in 1:4){\n  plot(density(traits.finch[as.factor(Tsp.finch)==levels(as.factor(Tsp.finch))[2],t], na.rm=T), ylim=c(0,0.9), xlim=c(min(traits.finch[,t], na.rm=T),max(traits.finch[,t], na.rm=T)), col=rainbow(13)[2])\n\n  for(sp in c(1,3:nlevels(as.factor(Tsp.finch)))){\n    if(sum(traits.finch[as.factor(Tsp.finch)==levels(as.factor(Tsp.finch))[sp],t], na.rm=T)>0) \n    {lines(density(traits.finch[as.factor(Tsp.finch)==levels(as.factor(Tsp.finch))[sp],t], na.rm=T), ylim=c(0,0.9), xlim=c(min(traits.finch[,t], na.rm=T),max(traits.finch[,t], na.rm=T)), col=rainbow(13)[sp])}\n  }\n}\n\npar(mfrow=c(1,1))\n\n\n\nind.plot.finch<-as.factor(as.vector(finch$IslandID[finch$IslandID!=\"Cocos\"]))\n\nres.finch<-Tstats(traits.finch[finch$IslandID!=\"Cocos\",], Tind_plot=ind.plot.finch, Tsp=Tsp.finch[finch$IslandID!=\"Cocos\"], nperm=999)\n\n\nsvg(\"Rplot%03d.svg\", width = 12, height = 12) #sauvegarde dans dossier document\n\ndev.off()\n\nplot.ses.Tstats(res.finch)\nplot.ses.Tstats(res.finch, type=\"color_cond\")\nplot.ses.Tstats(res.finch, type=\"simple\")\nplot.ses.Tstats(res.finch, type=\"simple_range\")\nplot.ses.Tstats(res.finch, type=\"barplot\")\n\n\nres.finch.sp<-com.jung(traits=traits.finch[finch$IslandID!=\"Cocos\",], ind.plot=ind.plot.finch, nperm=999, name_sp_site=paste(Tsp.finch[finch$IslandID!=\"Cocos\"], finch$IslandID[finch$IslandID!=\"Cocos\"], sep=\"_\"), pop.level=TRUE)\nres.finch.ind<-com.jung(traits=traits.finch[finch$IslandID!=\"Cocos\",], ind.plot=ind.plot.finch, nperm=999, name_sp_site=paste(Tsp.finch[finch$IslandID!=\"Cocos\"], finch$IslandID[finch$IslandID!=\"Cocos\"], sep=\"_\"), pop.level=F)\n\nplot.filter(jung.object.ind=res.finch.ind, jung.object.sp=res.finch.sp, tstats=res.finch, val.quant=c(0.025, 0.975), bysites=TRUE )\n\n\nplot.jung(res.finch.sp)\nplot.jung(res.finch.ind)\n\n\nrequire(lattice)\ndotplot(rep(colnames(traits.finch[finch$IslandID!=\"Cocos\",]),6) ~ as.vector(ses(res.finch$T_IP.IC,res.finch$T_IP.IC_nm)$ses) | as.factor(sort(rep(1:nrow(res.finch$pval_T_IP.IC.inf), times=4))))\ndotplot(rep(colnames(traits.finch[finch$IslandID!=\"Cocos\",]),6) ~ as.vector(ses(res.finch$T_IP.IC,res.finch$T_IP.IC_nm)$ses.inf) | as.factor(sort(rep(1:nrow(res.finch$pval_T_IP.IC.inf),times=4))), add=T, col=\"red\")\ndotplot(rep(colnames(traits.finch[finch$IslandID!=\"Cocos\",]),6) ~ as.vector(ses(res.finch$T_IP.IC,res.finch$T_IP.IC_nm)$ses.sup) | as.factor(sort(rep(1:nrow(res.finch$pval_T_IP.IC.sup),times=4))), add=T, col=\"red\")\n\n\nlevelplot(t(mat_ass_comm(jung.object=res.finch.sp,tstats=res.finch)))\nplot.mat_comm(mat_ass_comm(jung.object=res.finch.sp,tstats=res.finch), nindex=7, Circles=TRUE)\nplot.mat_comm(mat_ass_comm(tstats=res.finch), nindex=3, Circles=TRUE)\nplot.mat_comm(mat_ass_comm(tstats=res.finch, val.quant=c(0.05,0.95)), nindex=3, Circles=TRUE)\nplot.mat_comm(-mat_ass_comm(tstats=res.finch), nindex=3, Circles=TRUE)\n\nplot.mat_comm(mat_ass_comm(tstats=res.finch), nindex=3, Circles=F)\nplot.mat_comm(mat_ass_comm(jung.object=res.finch.sp,tstats=res.finch), nindex=7, Circles=F)\n\n\nrequire(rasterVis)\n\n# Custom theme (from rasterVis package)\nmy.theme <- BuRdTheme()\n\n# Customize the colorkey\nmy.ckey <- list(col=my.theme$regions$col)\n\nlevelplot(t(rbind(res.finch$pval_T_IP.IC.inf,res.finch$pval_T_IC.IR.inf,res.finch$pval_T_PC.PR.inf)), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\n\n\nlevelplot(t(res.finch$pval_T_IP.IC.inf), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\nlevelplot(t(res.finch$pval_T_IP.IC.sup), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\nlevelplot(t(res.finch$pval_T_IC.IR.inf), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\nlevelplot(t(res.finch$pval_T_PC.PR.inf), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\n\nlevelplot(t(ses(res.finch$T_IP.IC,res.finch$T_IP.IC_nm)$ses), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\nlevelplot(t(ses(res.finch$T_IC.IR,res.finch$T_IC.IR_nm)$ses), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\nlevelplot(t(ses(res.finch$T_PC.PR,res.finch$T_PC.PR_nm)$ses), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\n\nlevelplot(cbind(t(ses(res.finch$T_IP.IC,res.finch$T_IP.IC_nm)$ses), t(ses(res.finch$T_IC.IR,res.finch$T_IP.IC_nm)$ses), t(ses(res.finch$T_PC.PR,res.finch$T_IP.IC_nm)$ses)) , colorkey=my.ckey, par.settings=my.theme,border=\"black\")\n\nlevelplot(t(mat_ass_comm(jung.object=res.finch.sp,tstats=res.finch)), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\nlevelplot(t(mat_ass_comm(jung.object=res.finch.sp,tstats=res.finch))+t(mat_ass_comm(jung.object=res.finch.sp,tstats=res.finch, val.quant=c(0.05,0.95))), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\n\nlevelplot(t(mat_ass_comm(jung.object=res.finch.sp,tstats=res.finch, method=\"p.val\")), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\nlevelplot(t(mat_ass_comm(jung.object=res.finch.sp,tstats=res.finch, method=\"ses\")), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\n\n\ntraits=traits.finch\nvar.1=Tsp.finch\nvar.2=ind.plot_finch\ncol.dens=NULL\nplot.ask=TRUE\nylim.cex=1\ncex.leg=0.8\npolyg=TRUE\nsort.by.traits=F\n\n\n\n\n\n\nplot.dens(traits[finch$IslandID!=\"Cocos\",], as.factor(Tsp.finch[finch$IslandID!=\"Cocos\"]), ind.plot.finch, ylim.cex=3)\nplot.dens(traits[finch$IslandID!=\"Cocos\",], ind.plot.finch, Tsp.finch[finch$IslandID!=\"Cocos\"], ylim.cex=3)\nplot.dens(traits[finch$IslandID!=\"Cocos\",], rep(\"region\", times=dim(traits[finch$IslandID!=\"Cocos\",])[1]), Tsp.finch[finch$IslandID!=\"Cocos\"], ylim.cex=3)\nplot.dens(traits[finch$IslandID!=\"Cocos\",], rep(\"toutes_sp\", times=dim(traits[finch$IslandID!=\"Cocos\",])[1]), ind.plot.finch,ylim.cex=3)\n\nplot.dens(traits[finch$IslandID!=\"Cocos\",], as.factor(Tsp.finch[finch$IslandID!=\"Cocos\"]), ind.plot.finch, ylim.cex=3, sort.by.trait=T)\nplot.dens(traits[finch$IslandID!=\"Cocos\",], ind.plot.finch, Tsp.finch[finch$IslandID!=\"Cocos\"], ylim.cex=3)\n\n\n\n\n####test of Aiba et al,2013 simulation####\n\ncom.traits<-cbind(1:2677,traits.finch)[finch$IslandID!=\"Cocos\",]\n\n\nmy.sim (2,compete_upto, trait=com.traits, trait.m=com.traits, snum=5, condition=condition, pop.compet=F)\n\n\nsp=Tsp.finch\n\n\nres.comp.popT<-my.sim (2, compete_until, trait=com.traits, trait.m=com.traits, snum=2600, sp=Tsp.finch, cp=1)\nres.comp.popF<-my.sim (2, compete_until, trait=com.traits, trait.m=com.traits, snum=2600, sp=Tsp.finch, cp=1/2)\n\nres.comp.pop1<-my.sim (2, compete_upto, trait=com.traits, trait.m=com.traits, snum=100)\nres.comp.pop2<-my.sim (2, compete_upto, trait=com.traits, trait.m=com.traits, snum=100, sp=Tsp.finch, cp=1/2)\nres.comp.pop3<-my.sim (2, compete_upto, trait=com.traits, trait.m=com.traits, snum=100, sp=Tsp.finch, cp=0)\n\nres.comp.pop1<-my.sim (2, filrand_until, trait=com.traits, trait.m=com.traits, snum=100, prob=0.5)\nres.comp.pop1<-my.sim (2, rand.p.fil_upto, trait=com.traits, trait.m=com.traits, snum=100)\n\n\ntable(Tsp.finch[as.numeric(labels(res.comp.pop1))])\ntable(Tsp.finch[as.numeric(labels(res.comp.pop2))])\ntable(Tsp.finch[as.numeric(labels(res.comp.pop3))])\n\n\n\n\n\n\nnames_sp_ind_plot<-as.factor(paste(Tsp.finch[finch$IslandID!=\"Cocos\"], finch$IslandID[finch$IslandID!=\"Cocos\"], sep=\"_\"))\n\nTplotsp<-unlist(strsplit(levels(names_sp_ind_plot),split=\"_\"))[3*(1:nlevels(names_sp_ind_plot))]\nnames(Tplotsp)=levels(names_sp_ind_plot)\n\nTind_plot<-unlist(strsplit(as.vector(names_sp_ind_plot),split=\"_\"))[3*(1:length(names_sp_ind_plot))]\nnames(Tind_plot)=levels(names_sp_ind_plot)\n\nrich<-table(Tplotsp)\nlist.finch<-list(T_IP.IC=res.finch$T_IP.IC, T_IP.IC_nm=res.finch$T_IP.IC_nm, T_PC.PR=res.finch$T_PC.PR, T_PC.PR_nm=res.finch$T_PC.PR_nm, T_IC.IR=res.finch$T_IC.IR, T_IC.IR_nm=res.finch$T_IC.IR_nm)\n\nplot.ses.var(list.finch, rich)\n\n\n\n\n\n\n\n\n\n\n####################################################################\n#SIMULATIONS\n####################################################################\n\nnperm=2\nres.random_until\nres.random_upto\nres.filter_until\nres.filter_upto\nres.compete_until\nres.compete_upto\n\n\nres.Tstats.compete_upto<-list()\nfor(i in 1:nperm){\n  res.compete_upto<-labels(my.sim (2, compete_upto, trait=com.traits, trait.m=com.traits, snum=10, sp=as.factor(Tsp.finch[finch$IslandID!=\"Cocos\"]), cp=1/2))\n  \n  cond<-as.numeric(res.compete_upto)\n  \n  res.Tstats.compete_upto[[i]]<-Tstats(traits.finch[cond,], Tind_plot=ind.plot.finch[cond], Tsp=Tsp.finch[cond], nperm=0)\n  \n}\n\n\n\n\n\npartvar(traits.finch[finch$IslandID!=\"Cocos\",], )\n\n\n\n\n\n\n\n#### Hypervolume ####        Pas encore bon...\n\nrequire(mice)\n\nTtraits<-traits.finch[finch$IslandID!=\"Cocos\",]\nimp<-mice(Ttraits)\nTtraits<-complete(imp)\n\nTind_plot<-ind.plot.finch\nTsp<-Tsp.finch[finch$IslandID!=\"Cocos\"]\nnperm=2\nprintprogress=TRUE\np.value=TRUE\nreps=1000\nbandwidth=0.2\nWarnings = T\n\nres.hv<-Tstats.hv(Ttraits,ind.plot.finch,Tsp, nperm=10, Warnings=F)\nses(res.hv$T_IP.IC, res.hv$T_IP.IC_nm)\nses(res.hv$T_IC.IR, res.hv$T_IC.IR_nm)\nses(res.hv$T_PC.PR, res.hv$T_PC.PR_nm)\n",
    "created" : 1392714754590.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1534193071",
    "id" : "EE43CB13",
    "lastKnownWriteTime" : 1392742149,
    "path" : "C:/Users/taudiere/Dropbox/3-THESE/Article T stats/#Tstats Darwin finch.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}