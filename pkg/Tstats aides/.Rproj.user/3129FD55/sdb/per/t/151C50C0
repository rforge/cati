{
    "contents" : "#Analyse propre Tstats\n\n# read in data\nind  <- read.csv(\"~/Documents/cours svtue/2-Master/Stage_VarIntra/Donnees/ind.csv\", header=T, sep = \";\", dec=\".\")\nleaf <- read.csv(\"~/Documents/cours svtue/2-Master/Stage_VarIntra/Donnees/traits.csv\", header=T, sep = \"\\t\", dec=\".\")\ntax  <- read.csv(\"~/Documents/cours svtue/2-Master/Stage_VarIntra/Donnees/tax.csv\", header=T, sep = \"\\t\", dec=\".\")\n\n\n\nsource(\"C:/Users/taudiere/Dropbox/3-THESE/Article T stats/Package Tstats//function_CVNND.R\")\nsource(\"C:/Users/taudiere/Dropbox/3-THESE/Article T stats/Package Tstats//function_Tstats.r\")\nsource(\"C:/Users/taudiere/Dropbox/3-THESE/Article T stats/Package Tstats//function_variance.R\")\n\n\nsource('~/Dropbox/3-THESE/Article T stats/Package Tstats/function_CVNND.R')\nsource('~/Dropbox/3-THESE/Article T stats/Package Tstats/function_Tstats.r')\nsource('~/Dropbox/3-THESE/Article T stats/Package Tstats/function_variance.R')\n\n\n#puis: lancer script BRIDGE trait prep script\n\n#puis:\n\n#distribution globale des traits sur feuilles\ntraits.leaf.selec<-c(\"chlor\",\"thickness\",\"log_toughness\",\"log_SLA\",\"log_dry_mass\",\"log_lflt_area\")\nleaf.traits<-leaf[,which(names(leaf)%in%traits.leaf.selec)]\n\n#distribution globale des traits sur individus\ntraits.ind.selec<-c( \"stature\", \"Height\", \"chlor\", \"log_SLA\", \"thickness\",\"log_tough\",\"log_dry_mass\",\"log_lflt_area\",\"log_LTD\",\"log_lf_area\", \"P\",\"K\",\"Na\", \"C_N\", \"N\", \"C\",\"C13\", \"N15\", \"NO3\", \"NH4\", \"N2\",\"Al\",\"B\",\"Ca\",\"Cu\",\"Fe\",\"Mg\",\"Mn\",\"Mo\",\"S\",\"Zn\",\"log_moist\",\"sapwood_dens\",\"bark_thick\",\"twig_dens\")\nind.traits<-ind[,which(names(ind)%in%traits.ind.selec)]\nind.traits$B[ind.traits$B==\"\"]<-NA\nind.traits$B<-as.numeric(as.vector(ind.traits$B))\nind.traits$Zn[ind.traits$Zn==\"\"]<-NA\nind.traits$Zn<-as.numeric(as.vector(ind.traits$Zn))\n\n#add LDMC in leaf trait\n#ind.traits<-cbind(ind.traits[1:35],1/(ind.traits$thickness*ind.traits$log_SLA))\n#colnames(ind.traits)[36]<-\"LDMC\"\n\n#s?lection des traits individus les plus int?ressants\ntraits.ind.selection<-c( \"stature\", \"Height\", \"chlor\", \"log_SLA\", \"thickness\",\"log_tough\",\"log_dry_mass\",\"log_lflt_area\",\"log_LTD\",\"log_lf_area\", \"P\",\"K\", \"C_N\", \"N\", \"C\",\"C13\", \"N15\",\"log_moist\",\"sapwood_dens\",\"bark_thick\",\"twig_dens\")\nTR<-match(traits.ind.selection,colnames(ind.traits))\n\n#je remplace les -inf par des NA pour le log_lf_area\nind.traits[,29][!is.finite(ind.traits[,29])]<-NA\n\n\n\n\nTind_plot2<-gsub(\"A11\",\"A\",ind$plot_code)\nTind_plot2<-gsub(\"B4\",\"B\",Tind_plot2)\nTind_plot2<-gsub(\"LV1\",\"LV\",Tind_plot2)\nTind_plot2<-gsub(\"M1711\",\"M\",Tind_plot2)\nTind_plot2<-gsub(\"NH20\",\"NH\",Tind_plot2)\nTind_plot2<-gsub(\"NL11\",\"NL\",Tind_plot2)\nTind_plot2<-gsub(\"P006\",\"P6\",Tind_plot2)\nTind_plot2<-gsub(\"P018\",\"P18\",Tind_plot2)\nTind_plot2<-gsub(\"T1\",\"T\",Tind_plot2)\nTind_plot2<-as.factor(Tind_plot2)\n\nTplotsp2<-gsub(\"A11\",\"A\",sp_plot$plot_code)\nTplotsp2<-gsub(\"B4\",\"B\",Tplotsp2)\nTplotsp2<-gsub(\"LV1\",\"LV\",Tplotsp2)\nTplotsp2<-gsub(\"M1711\",\"M\",Tplotsp2)\nTplotsp2<-gsub(\"NH20\",\"NH\",Tplotsp2)\nTplotsp2<-gsub(\"NL11\",\"NL\",Tplotsp2)\nTplotsp2<-gsub(\"P006\",\"P6\",Tplotsp2)\nTplotsp2<-gsub(\"P018\",\"P18\",Tplotsp2)\nTplotsp2<-gsub(\"T1\",\"T\",Tplotsp2)\nTplotsp2<-as.factor(Tplotsp2)\n\n\n\n\nres.Tstats<-Tstats(Ttraits=ind.traits[,TR], Tind_plot=Tind_plot2, Tsp=paste(ind$Genus, ind$species, sep=\"_\"), nperm=999, printprogress=TRUE, p.value=TRUE)\n\nres.jung.sp<-com.jung(traits=ind.traits[,TR], ind.sites=ind.sites.jung, ind.plot=Tind_plot2, nperm=999, name_sp_site=paste(ind$Genus,ind$species, ind$plot_code, sep=\"_\"), pop.level=TRUE)\nres.jung.ind<-com.jung(traits=ind.traits[,TR], ind.sites=ind.sites.jung, ind.plot=Tind_plot2, nperm=999, name_sp_site=paste(ind$Genus,ind$species, ind$plot_code, sep=\"_\"), pop.level=FALSE)\n\n\nplot.filter(jung.object.ind=res.jung.ind, jung.object.sp=res.jung.sp, tstats=res.Tstats, val.quant=c(0.025, 0.975), bysites=TRUE )\nplot.filter(jung.object.ind=res.jung.ind, jung.object.sp=res.jung.sp, tstats=res.Tstats, val.quant=c(0.025, 0.975), bysites=FALSE)\n\nplot.filter(jung.object.ind=res.jung.ind, jung.object.sp=res.jung.sp, tstats=res.Tstats, val.quant=c(0.025, 0.975), bysites=TRUE, cex.text=0.2)\nplot.filter(jung.object.ind=res.jung.ind, jung.object.sp=res.jung.sp, tstats=res.Tstats, val.quant=c(0.025, 0.975), bysites=FALSE, cex.text=0.2)\n\n\nsvg(\"Rplot%03d.svg\", width = 12, height = 12) #sauvegarde dans dossier document\n\ndev.off()\n\n\nplot.mat_comm(mat_ass_comm(jung.object=res.jung.sp,tstats=res.Tstats), nindex=7)\nplot.mat_comm(mat_ass_comm(jung.object=res.jung.sp,tstats=res.Tstats,val.quant=c(0.05,0.95)), nindex=7)\nplot.mat_comm(mat_ass_comm(jung.object=res.jung.sp,tstats=res.Tstats)+mat_ass_comm(jung.object=res.jung.sp,tstats=res.Tstats,val.quant=c(0.05,0.95)), nindex=7)\nplot.mat_comm(mat_ass_comm(jung.object=res.jung.sp,tstats=res.Tstats)+mat_ass_comm(jung.object=res.jung.sp,tstats=res.Tstats,val.quant=c(0.01,0.99)), nindex=7)\n\n\nplot.mat_comm(mat_ass_comm(jung.object=res.jung.sp,tstats=res.Tstats), nindex=7, Circles=TRUE)\nplot.mat_comm(-mat_ass_comm(jung.object=res.jung.sp,tstats=res.Tstats), nindex=7, Circles=TRUE)\n\n\nrequire(rasterVis)\nrequire(lattice)\n# Custom theme (from rasterVis package)\nmy.theme <- BuRdTheme()\n\n# Customize the colorkey\nmy.ckey <- list(col=my.theme$regions$col)\n\nlevelplot(t(rbind(res.Tstats$pval_T_IP.IC.inf,res.Tstats$pval_T_IC.IR.inf,res.Tstats$pval_T_PC.PR.inf)), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\n\n\nlevelplot(t(res.Tstats$pval_T_IP.IC.inf), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\nlevelplot(t(res.Tstats$pval_T_IC.IR.inf), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\nlevelplot(t(res.Tstats$pval_T_PC.PR.inf), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\nlevelplot(t(ses(res.Tstats$T_IP.IC,res.Tstats$T_IP.IC_nm)$ses), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\nlevelplot(t(ses(res.Tstats$T_IP.IC,res.Tstats$T_IC.IR_nm)$ses), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\nlevelplot(t(ses(res.Tstats$T_IP.IC,res.Tstats$T_PC.PR_nm)$ses), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\n\nlevelplot(t(mat_ass_comm(jung.object=res.jung.sp,tstats=res.Tstats)), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\nlevelplot(t(mat_ass_comm(jung.object=res.jung.sp,tstats=res.Tstats, method=\"ses\")), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\nlevelplot(t(mat_ass_comm(jung.object=res.jung.sp,tstats=res.Tstats)+mat_ass_comm(jung.object=res.jung.sp,tstats=res.Tstats,val.quant=c(0.05,0.95))), colorkey=my.ckey, par.settings=my.theme,border=\"black\")\n\n\n\n\n\n\n\nrange.nm.ind = array(unlist(res.jung.ind$Null_range), dim=c(ncol(res.jung.ind$Null_range[[1]]), nrow(res.jung.ind$Null_range[[1]]), length(unlist(res.jung.ind$Null_range))/nrow(res.jung.ind$Null_range[[1]])/ncol(res.jung.ind$Null_range[[1]])) )\nmean.nm.ind = array(unlist(res.jung.ind$Null_mean), dim=c(ncol(res.jung.ind$Null_mean[[1]]), nrow(res.jung.ind$Null_mean[[1]]), length(unlist(res.jung.ind$Null_mean))/nrow(res.jung.ind$Null_mean[[1]])/ncol(res.jung.ind$Null_mean[[1]])) )\nkurtosis.nm.ind = array(unlist(res.jung.ind$Null_kurtosis), dim=c(ncol(res.jung.ind$Null_kurtosis[[1]]), nrow(res.jung.ind$Null_kurtosis[[1]]), length(unlist(res.jung.ind$Null_kurtosis))/nrow(res.jung.ind$Null_kurtosis[[1]])/ncol(res.jung.ind$Null_kurtosis[[1]])) )\nCV.nm.ind = array(unlist(res.jung.ind$Null_CV), dim=c(ncol(res.jung.ind$Null_CV[[1]]), nrow(res.jung.ind$Null_CV[[1]]), length(unlist(res.jung.ind$Null_CV))/nrow(res.jung.ind$Null_CV[[1]])/ncol(res.jung.ind$Null_CV[[1]])) )\n\n\nrange.nm.sp = array(unlist(res.jung.sp$Null_range), dim=c(ncol(res.jung.sp$Null_range[[1]]), nrow(res.jung.sp$Null_range[[1]]), length(unlist(res.jung.sp$Null_range))/nrow(res.jung.sp$Null_range[[1]])/ncol(res.jung.sp$Null_range[[1]])) )\nmean.nm.sp = array(unlist(res.jung.sp$Null_mean), dim=c(ncol(res.jung.sp$Null_mean[[1]]), nrow(res.jung.sp$Null_mean[[1]]), length(unlist(res.jung.sp$Null_mean))/nrow(res.jung.sp$Null_mean[[1]])/ncol(res.jung.sp$Null_mean[[1]])) )\nkurtosis.nm.sp = array(unlist(res.jung.sp$Null_kurtosis), dim=c(ncol(res.jung.sp$Null_kurtosis[[1]]), nrow(res.jung.sp$Null_kurtosis[[1]]), length(unlist(res.jung.sp$Null_kurtosis))/nrow(res.jung.sp$Null_kurtosis[[1]])/ncol(res.jung.sp$Null_kurtosis[[1]])) )\nCV.nm.sp = array(unlist(res.jung.sp$Null_CV), dim=c(ncol(res.jung.sp$Null_CV[[1]]), nrow(res.jung.sp$Null_CV[[1]]), length(unlist(res.jung.sp$Null_CV))/nrow(res.jung.sp$Null_CV[[1]])/ncol(res.jung.sp$Null_CV[[1]])) )\n\n\n\nres.jung.ind$Range_obs[is.infinite(res.jung.ind$Range_obs)]<-NA\nres.jung.sp$Range_obs[is.infinite(res.jung.sp$Range_obs)]<-NA\n\n\n\n\n\n\n\nindex.list<-list(T_IP.IC=res.Tstats$T_IP.IC, T_IP.IC_nm=res.Tstats$T_IP.IC_nm, \n                 kurtosis.ind=t(res.jung.ind$kurtosis_obs), kurtosis_nm.ind=kurtosis.nm.ind, \n                 CV.NND.ind=t(res.jung.ind$CV.NND_obs), CV_nm.ind=CV.nm.ind,\n                 \n                 T_IC.IR=res.Tstats$T_IC.IR, T_IC.IR_nm=res.Tstats$T_IC.IR_nm, \n                 range.ind=t(res.jung.ind$Range_obs), range_nm.ind=range.nm.ind, \n                 mean.ind=t(res.jung.ind$Mean_obs), mean_nm.ind=mean.nm.ind, \n                 \n                 kurtosis.sp=t(res.jung.sp$kurtosis_obs), kurtosis_nm.sp=kurtosis.nm.sp, \n                 CV.NND.sp=t(res.jung.sp$CV.NND_obs), CV_nm.sp=CV.nm.sp,\n                                  \n                 T_PC.PR=res.Tstats$T_PC.PR, T_PC.PR_nm=res.Tstats$T_PC.PR_nm,\n                 range.sp=t(res.jung.sp$Range_obs), range_nm.sp=range.nm.sp,\n                 mean.sp=t(res.jung.sp$Mean_obs), mean_nm.sp=mean.nm.sp) \n                 \ncol.index<-c(\"red\",\"red\",\"red\",\"orange\",\"orange\",\"orange\",\"blue\",\"blue\",\"purple\",\"purple\",\"purple\")\n\n\nindex.list.Tstats<-list(T_IP.IC=res.Tstats$T_IP.IC, T_IP.IC_nm=res.Tstats$T_IP.IC_nm, \n                 T_IC.IR=res.Tstats$T_IC.IR, T_IC.IR_nm=res.Tstats$T_IC.IR_nm, \n                 T_PC.PR=res.Tstats$T_PC.PR, T_PC.PR_nm=res.Tstats$T_PC.PR_nm)                 \n\nplot.ses(index.list,col.index=col.index)\nplot.ses(index.list.Tstats)\n\n\n\n\n\nplot.ses(index.list.Tstats, type=\"simple\", add.conf=F)\nplot.ses(index.list.Tstats, type=\"barplot\")\nplot.ses(index.list.Tstats, type=\"normal\")\nplot.ses(index.list.Tstats, type=\"normal\", add.conf=F)\nplot.ses(index.list.Tstats, type=\"simple_range\", add.conf=F)\n\n\n\nplot.dens(ind.traits[,TR], Tind_plot2, ind$Genus, ylim.cex=3)\n\nplot.dens(ind.traits[,TR], ind$Genus, Tind_plot2, ylim.cex=3)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#### Hypervolume ####\n\nrequire(mice)\n\nTtraits<-ind.traits[,TR]\nimp<-mice(Ttraits)\nTtraits<-complete(imp)\nTsp=paste(ind$Genus, ind$species, sep=\"_\")\n\nres.hv<-Tstats.hv(Ttraits[1:1000,],Tind_plot2[1:1000],Tsp[1:1000], nperm=5, Warnings=F)\n",
    "created" : 1392714821525.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "740439352",
    "id" : "151C50C0",
    "lastKnownWriteTime" : 1392739235,
    "path" : "C:/Users/taudiere/Dropbox/3-THESE/Article T stats/Analyses propre Tstats.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}